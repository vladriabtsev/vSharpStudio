syntax = "proto3";

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/any.proto";

//import "connections.proto";

package proto_config;
option csharp_namespace = "Proto.Config";

/** 
 * @exclude
 * use 'proto_' prefix for all messages !!!
 * ####################################### S E T T I N G S ##################################
 */
message proto_group_list_plugins {
    // @attr [BrowsableAttribute(false)]
    uint64 sorting_value = 3;
    // @attr [BrowsableAttribute(false)]
    repeated proto_plugin list_plugins = 4;
}
message proto_plugin {
    // @attr [Editable(false)]
    string guid = 1;
    // @attr [Editable(false)]
    string name = 2;
    // @attr [Editable(false)]
    string description = 3;
    // @attr [BrowsableAttribute(false)]
    uint64 sorting_value = 4;
    // @attr [BrowsableAttribute(false)]
    repeated proto_plugin_generator list_plugin_generators = 5;
}
message proto_plugin_generator {
    // @attr [Editable(false)]
    string guid = 1;
    // @attr [Editable(false)]
    string name = 2;
    // @attr [Editable(false)]
    string description = 3;
    // @attr [BrowsableAttribute(false)]
    uint64 sorting_value = 4;
    // @attr [BrowsableAttribute(false)]
    repeated proto_plugin_generator_settings list_plugin_generator_settings = 5;
}
message proto_plugin_generator_settings {
    // This Guid is taken from Plugin Generator
    // @attr [BrowsableAttribute(false)]
    string guid = 1;
    // This Name is taken from Plugin Generator
    // @attr [PropertyOrderAttribute(1)]
    string name = 2;
    // This Description is taken from Plugin Generator
    // @attr [PropertyOrderAttribute(2)]
    // @attr [Editable(false)]
    string description = 3;
    // @attr [BrowsableAttribute(false)]
    uint64 sorting_value = 4;
    // @attr [BrowsableAttribute(false)]
    string generator_settings = 5;
    // @attr [PropertyOrderAttribute(3)]
    // @attr [Description("If false, connection string settings will be stored in configuration file. If true, will be stored in separate file.")]
    bool is_private = 6;
    // @attr [PropertyOrderAttribute(4)]
    // @attr [Editor(typeof(FilePickerEditor), typeof(ITypeEditor))]
    // @attr [Description("File path to store connection string settings in private place.")]
    string file_path = 7;
}
message proto_settings_config {
    string guid = 1;
    string name = 2;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // current migration version, increased by one on each deployment
    int32 version_migration_current = 7;
    // min version supported by current version for migration
    int32 version_migration_support_from_min = 8;
}

// Primary key generation strategy
// @base : ViewModelValidatableWithSeverity<DbIdGenerator, DbIdGenerator.DbIdGeneratorValidator>
message db_id_generator {
    bool_nullable is_primary_key_clustered = 10; // MsSql
    bool_nullable is_memory_optimized = 11; // MsSql
    bool_nullable is_sequence_hi_lo = 12; // SequenceHiLo or IdentityColumn. MsSql
    string hi_lo_sequence_name = 13; // MsSql
    string hi_lo_schema = 14; // MsSql
}
/** 
 * @exclude
 * ####################################### C O N F I G ##########################################
 */
message proto_group_configs {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
//  string name_ui = 4;
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_config_tree children = 6;
    string relative_config_path = 7;
}
message proto_config_tree {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
//  string name_ui = 4;
    string description = 5;
    proto_config config_node = 6;
    // @attr [BrowsableAttribute(false)]
    repeated proto_config_tree children = 7;
}
// Configuration config
message proto_config {
    // Unique Guid for configuration (for comparison)
    string guid = 1;
    string version = 2;
    string name = 3;
    uint64 sorting_value = 4;
    // @attr [PropertyOrderAttribute(2)]
    string name_ui = 5;
    // @attr [PropertyOrderAttribute(3)]
    string description = 6;

    // VM
    //string vm_namespace = 10;

    // CONNECTION STRING SECTION

    // if yes: 
    //    Try to find one connecion string in config file. If more than one connection string found we use use connection_string_name.
    // if no:
    //    1. Find DB type from 
    //    2. Create connection string from db_server, db_database_name, db_user
    bool is_db_from_connection_string = 11; 
    string connection_string_name = 12;
    enum EnumDbType {
        MS_SQL_SERVER = 0;
        MS_SQL_FILE = 1;
    }

    EnumDbType db_type_enum = 13;
    string db_server = 14;
    string db_database_name = 15;
    bool is_db_windows_authentication = 16; 
    string db_user = 17;
    string db_password = 18;
    // path to project with config file containing connection string. Usefull for UNIT tests.
    // it will override previous settings
    string path_to_project_with_connection_string = 19;

    // GENERAL DB SETTINGS

    string db_schema = 31;
    string primary_key_name = 32;

    // @attr [ExpandableObjectAttribute()]
    db_id_generator db_id_generator = 33;


    // CONFIG OBJECTS
    proto_group_list_plugins group_plugins = 99;
    proto_group_configs group_configs = 100;
    proto_group_list_constants group_constants = 101;
    proto_group_list_enumerations group_enumerations = 102;
    proto_group_list_catalogs group_catalogs = 103;
    proto_group_documents group_documents = 104;
    proto_group_list_journals group_journals = 105;

    //proto_connections.proto_group_connections group_connections = 121; 
}
/** 
 * @exclude
 * ####################################### D A T A  T Y P E ##########################################
 */
// @base : ViewModelValidatableWithSeverity<DataType, DataType.DataTypeValidator>
message proto_data_type {
    enum EnumDataType {
        STRING = 0;
        NUMERICAL = 1;
        BOOL = 5;

        //CONSTANT = 7;
        ENUMERATION = 8;
        CATALOG = 9;
        CATALOGS = 10;
        DOCUMENT = 11;
        DOCUMENTS = 12;

        Any = 15;
    }
    // @attr [PropertyOrderAttribute(1)][DisplayName("Type")]
    EnumDataType data_type_enum = 1; 
    // @attr [PropertyOrderAttribute(3)]
    uint32 length = 2; 
    // @attr [PropertyOrderAttribute(5)]
    uint32 accuracy = 3; 
    // @attr [PropertyOrderAttribute(4)][DisplayName("Is positive")]
    bool is_positive = 4; 
    // @attr [PropertyOrderAttribute(2)][Editor(typeof(DataTypeObjectNameEditor), typeof(DataTypeObjectNameEditor))]
    string object_guid = 5;
}
/** 
 * @exclude
 * ####################################### P R O P E R T Y ##########################################
 */
message proto_group_list_properties_tabs {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_group_properties_tab children = 6;
}
message proto_group_properties_tab {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_properties group_properties = 7;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_properties_tabs group_properties_subtabs = 6;
}
message proto_group_list_properties {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_property children = 6;
}
message proto_property {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [PropertyOrderAttribute(4)][ExpandableObjectAttribute()][DisplayName("Type")]
    proto_data_type data_type = 6;
}
/** 
 * @exclude
 * ####################################### C O N S T A N T ##########################################
 */
message proto_group_list_constants {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_constant children = 6;
}
//
// Constant application wise value
//
message proto_constant {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [PropertyOrderAttribute(4)][ExpandableObjectAttribute()][DisplayName("Type")]
    proto_data_type data_type = 6;
}
/** 
 * @exclude
 * ####################################### E N U M E R A T I O N ##########################################
 */
message proto_group_list_enumerations {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_enumeration children = 6;
}
message proto_enumeration {
    enum EnumEnumerationType {
        STRING = 0;
        BYTE = 1;
        SHORT = 2;
        INTEGER = 3;
    }
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [PropertyOrderAttribute(4)][DisplayName("Type")]
    EnumEnumerationType data_type_enum = 6; 
    // @attr [DisplayName("Elements")][NewItemTypes(typeof(EnumerationPair))]
    repeated proto_enumeration_pair children = 7;
}
message proto_enumeration_pair {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // TODO struct for different types, at least INTEGER
    string value = 6;
}
/** 
 * @exclude
 * ####################################### C A T A L O G ##########################################
 */
message proto_catalog {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;

    // @attr [ExpandableObjectAttribute()]
    db_id_generator db_id_generator = 10;

    // @attr [BrowsableAttribute(false)]
    proto_group_list_properties group_properties = 15;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_forms group_forms = 17;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_reports group_reports = 18;
}
message proto_group_list_catalogs {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_catalog children = 7;
}
/** 
 * @exclude
 * ####################################### D O C U M E N T ##########################################
 */
message proto_group_documents {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_properties group_shared_properties = 6;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_documents group_list_documents = 7;
}
message proto_document {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_properties group_properties = 6;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_properties_tabs group_properties_tabs = 7;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_forms group_forms = 17;
    // @attr [BrowsableAttribute(false)]
    proto_group_list_reports group_reports = 18;
    // @attr [ExpandableObjectAttribute()]
    db_id_generator db_id_generator = 10;
}
message proto_group_list_documents {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    // @attr [BrowsableAttribute(false)]
    repeated proto_document children = 6;
}
/** 
 * @exclude
 * ####################################### J O U R N A L ##########################################
 */
message proto_group_list_journals {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    //repeated proto_property list_shared_properties = 6;
    // @attr [BrowsableAttribute(false)]
    repeated proto_journal children = 7;
}
message proto_journal {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    //repeated proto_group_properties list_properties = 6;
    // @attr [BrowsableAttribute(false)]
    repeated proto_document children = 7;
}
/** 
 * @exclude
 * ####################################### F O R M S ##########################################
 */
message proto_group_list_forms {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    //repeated proto_property list_shared_properties = 6;
    // @attr [BrowsableAttribute(false)]
    repeated proto_form children = 7;
}
message proto_form {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    //repeated proto_group_properties list_properties = 6;
    //repeated proto_document list_forms = 7;
}
/** 
 * @exclude
 * ####################################### R E P O R T S ##########################################
 */
message proto_group_list_reports {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    //repeated proto_property list_shared_properties = 6;
    // @attr [BrowsableAttribute(false)]
    repeated proto_report children = 7;
}
message proto_report {
    string guid = 1;
    string name = 2;
    uint64 sorting_value = 3;
    // @attr [PropertyOrderAttribute(2)][DisplayName("UI name")]
    string name_ui = 4;
    // @attr [PropertyOrderAttribute(3)]
    string description = 5;
    //repeated proto_group_properties list_properties = 6;
    //repeated proto_document list_documents = 7;
}
/** 
 * @exclude
 * ####################################### N U L L A B L E ##########################################
 */
// all simple nullable (generator check suffics '_nullable')
message bool_nullable {
    bool has_value = 1;
    bool value = 2;
}
message string_nullable {
    bool has_value = 1;
    string value = 2;
}
